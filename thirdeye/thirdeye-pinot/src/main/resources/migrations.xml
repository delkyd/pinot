<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.3.xsd">
    <changeSet author="npawar (generated)" id="1472070487388-1">
        <createTable tableName="anomaly_feedback">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="feedback_type" type="VARCHAR(100)"/>
            <column name="comment" type="VARCHAR(500)"/>
            <column name="status" type="VARCHAR(100)"/>
        </createTable>
    </changeSet>
    <changeSet author="npawar (generated)" id="1472070487388-2">
        <createTable tableName="anomaly_function_relations">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="parent_id" type="BIGINT"/>
            <column name="child_id" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet author="npawar (generated)" id="1472070487388-3">
        <createTable tableName="anomaly_functions">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="collection" type="VARCHAR(127)">
                <constraints nullable="false"/>
            </column>
            <column name="metric" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="type" type="VARCHAR(127)">
                <constraints nullable="false"/>
            </column>
            <column name="is_active" type="BIT(1)">
                <constraints nullable="false"/>
            </column>
            <column name="cron" type="VARCHAR(127)">
                <constraints nullable="false"/>
            </column>
            <column name="bucket_size" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="bucket_unit" type="VARCHAR(63)">
                <constraints nullable="false"/>
            </column>
            <column name="window_size" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="window_unit" type="VARCHAR(63)">
                <constraints nullable="false"/>
            </column>
            <column name="window_delay" type="INT"/>
            <column name="properties" type="BLOB"/>
            <column name="explore_dimensions" type="VARCHAR(255)"/>
            <column name="filters" type="VARCHAR(1023)"/>
            <column name="window_delay_unit" type="VARCHAR(63)">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="default_function_name" name="function_name" type="VARCHAR(1023)">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="SUM" name="metric_function" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="npawar (generated)" id="1472070487388-4">
        <createTable tableName="anomaly_jobs">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="job_name" type="VARCHAR(127)">
                <constraints nullable="false"/>
            </column>
            <column name="status" type="VARCHAR(31)">
                <constraints nullable="false"/>
            </column>
            <column name="schedule_start_time" type="BIGINT"/>
            <column name="schedule_end_time" type="BIGINT"/>
            <column name="window_start_time" type="BIGINT"/>
            <column name="window_end_time" type="BIGINT"/>
            <column defaultValueComputed="CURRENT_TIMESTAMP" name="last_modified" type="TIMESTAMP">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="npawar (generated)" id="1472070487388-5">
        <createTable tableName="anomaly_merged_results">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="collection" type="VARCHAR(127)">
                <constraints nullable="false"/>
            </column>
            <column name="metric" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="dimensions" type="VARCHAR(1023)">
                <constraints nullable="false"/>
            </column>
            <column name="start_time" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="end_time" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="created_time" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="anomaly_feedback_id" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet author="npawar (generated)" id="1472070487388-6">
        <createTable tableName="anomaly_results">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="function_id" type="BIGINT"/>
            <column name="start_time_utc" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="end_time_utc" type="BIGINT"/>
            <column name="dimensions" type="VARCHAR(1023)">
                <constraints nullable="false"/>
            </column>
            <column name="score" type="DOUBLE(22)">
                <constraints nullable="false"/>
            </column>
            <column name="weight" type="DOUBLE(22)">
                <constraints nullable="false"/>
            </column>
            <column name="properties" type="BLOB"/>
            <column name="creation_time_utc" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="message" type="VARCHAR(1023)"/>
            <column name="anomaly_feedback_id" type="BIGINT"/>
            <column defaultValueNumeric="0" name="data_missing" type="BIT(1)">
                <constraints nullable="false"/>
            </column>
            <column name="merged_result_id" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet author="npawar (generated)" id="1472070487388-7">
        <createTable tableName="anomaly_tasks">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="job_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="job_name" type="VARCHAR(127)">
                <constraints nullable="false"/>
            </column>
            <column name="worker_id" type="BIGINT"/>
            <column name="status" type="VARCHAR(31)">
                <constraints nullable="false"/>
            </column>
            <column name="task_type" type="VARCHAR(63)">
                <constraints nullable="false"/>
            </column>
            <column name="task_start_time" type="BIGINT"/>
            <column name="task_end_time" type="BIGINT"/>
            <column name="task_info" type="TEXT">
                <constraints nullable="false"/>
            </column>
            <column defaultValueComputed="CURRENT_TIMESTAMP" name="last_modified" type="TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="version" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="npawar (generated)" id="1472070487388-8">
        <createTable tableName="configs">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="collection" type="VARCHAR(127)">
                <constraints nullable="false"/>
            </column>
            <column name="configType" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="configBlob" type="BLOB">
                <constraints nullable="false"/>
            </column>
            <column name="tags" type="BLOB"/>
        </createTable>
    </changeSet>
    <changeSet author="npawar (generated)" id="1472070487388-9">
        <createTable tableName="email_configurations">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="collection" type="VARCHAR(127)">
                <constraints nullable="false"/>
            </column>
            <column name="metric" type="VARCHAR(127)">
                <constraints nullable="false"/>
            </column>
            <column name="from_address" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="to_addresses" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="cron" type="VARCHAR(127)">
                <constraints nullable="false"/>
            </column>
            <column name="smtp_host" type="VARCHAR(127)">
                <constraints nullable="false"/>
            </column>
            <column name="smtp_port" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="smtp_user" type="VARCHAR(127)"/>
            <column name="smtp_password" type="VARCHAR(127)"/>
            <column name="window_size" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="window_unit" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="is_active" type="BIT(1)">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="1" name="send_zero_anomaly_email" type="BIT(1)">
                <constraints nullable="false"/>
            </column>
            <column name="filters" type="VARCHAR(1023)"/>
            <column name="window_delay_unit" type="VARCHAR(63)">
                <constraints nullable="false"/>
            </column>
            <column name="window_delay" type="INT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="npawar (generated)" id="1472070487388-10">
        <createTable tableName="email_function_dependencies">
            <column defaultValueNumeric="0" name="email_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="function_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="npawar (generated)" id="1472070487388-11">
        <createTable tableName="metric_config">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="metric" type="VARCHAR(1023)">
                <constraints nullable="false"/>
            </column>
            <column name="fabrics" type="VARCHAR(1023)">
                <constraints nullable="false"/>
            </column>
            <column name="container" type="VARCHAR(1023)">
                <constraints nullable="false"/>
            </column>
            <column name="metric_type" type="VARCHAR(1023)">
                <constraints nullable="false"/>
            </column>
            <column name="ingraph_metric_type" type="VARCHAR(1023)">
                <constraints nullable="false"/>
            </column>
            <column name="num_avro_records" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="start" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="end" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="interval_period" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="bootstrap" type="BIT(1)">
                <constraints nullable="false"/>
            </column>
            <column name="granularity_size" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="granularity_unit" type="VARCHAR(1023)">
                <constraints nullable="false"/>
            </column>
            <column name="metric_alias" type="VARCHAR(1023)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="npawar (generated)" id="1472070487388-12">
        <createTable tableName="webapp_configs">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="config_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="collection" type="VARCHAR(127)">
                <constraints nullable="false"/>
            </column>
            <column name="config_type" type="VARCHAR(127)">
                <constraints nullable="false"/>
            </column>
            <column name="config" type="TEXT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="npawar (generated)" id="1472070487388-13">
        <addPrimaryKey columnNames="email_id, function_id" constraintName="PRIMARY" tableName="email_function_dependencies"/>
    </changeSet>
    <changeSet author="npawar (generated)" id="1472070487388-14">
        <addUniqueConstraint columnNames="config_id, collection, config_type" constraintName="unique_config_constraint" deferrable="false" disabled="false" initiallyDeferred="false" tableName="webapp_configs"/>
    </changeSet>
    <changeSet author="npawar (generated)" id="1472070487388-15">
        <addForeignKeyConstraint baseColumnNames="email_id" baseTableName="email_function_dependencies" constraintName="fk_email_id" deferrable="false" initiallyDeferred="false" onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="email_configurations" />
    </changeSet>
    <changeSet author="npawar (generated)" id="1472070487388-16">
        <addForeignKeyConstraint baseColumnNames="function_id" baseTableName="email_function_dependencies" constraintName="fk_function_id" deferrable="false" initiallyDeferred="false" onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="anomaly_functions" />
    </changeSet>
    <changeSet author="npawar (generated)" id="1472070487388-17">
        <createIndex indexName="fk_anomaly_function_child" tableName="anomaly_function_relations" unique="false">
            <column name="child_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="npawar (generated)" id="1472070487388-18">
        <createIndex indexName="fk_anomaly_function_parent" tableName="anomaly_function_relations" unique="false">
            <column name="parent_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="npawar (generated)" id="1472070487388-19">
        <createIndex indexName="fk_anomaly_merged_results_idx" tableName="anomaly_results" unique="false">
            <column name="merged_result_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="npawar (generated)" id="1472070487388-20">
        <createIndex indexName="fk_anomaly_results_feedback_fk" tableName="anomaly_results" unique="false">
            <column name="anomaly_feedback_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="npawar (generated)" id="1472070487388-21">
        <createIndex indexName="fk_merged_results_feedback_idx" tableName="anomaly_merged_results" unique="false">
            <column name="anomaly_feedback_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="npawar (generated)" id="1472070487388-22">
        <createIndex indexName="fk_result_function" tableName="anomaly_results" unique="false">
            <column name="function_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="npawar (generated)" id="1472070487388-23">
        <createIndex indexName="fk_task_job" tableName="anomaly_tasks" unique="false">
            <column name="job_id"/>
        </createIndex>
    </changeSet>
</databaseChangeLog>
